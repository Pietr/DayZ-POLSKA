local textHelp = "Poradnik w krótce...."
local textRules = "§1. Zachowania graczy i administratorów\na) Zachowania graczy\nZakazane jest wyzywanie, zastraszanie, poniżanie, prześladowanie innych graczy,\nZakazane jest podszywanie się pod osobę znajdującą się w składzie administracji,\nZakazane jest przeszkadzanie moderatorom/administratorom podczas wykonywania prac,\nZakazane jest nękanie administracji i graczy,\nZakazany jest spam/przeklinanie/krytykowanie serwera na chacie głównym, lokalnym, grupowym, Radnio-Chat (Kara surowa),\nZakazane jest prowokowanie graczy do robienia rzeczy sprzecznych z regulaminem serwera,\nZakazane jest "żebranie" itemów/pojazdów od administracji,\nZakazane jest posiadanie kilku kont na jednym serialu,\nZakazane jest oszukiwanie administracji,\nZakazane jest włamywanie się do baz,\nZakazane jest posiadanie tzw. niewidocznych nicków lub zawierające same znaki (np. . , ! @ # $ etc...)\nZakazane jest wykorzystywanie wszelkich błędów do wzbogacenia się lub do uprzykrzania komuś gry,\nZakazane jest zabijanie administratora/moderatora podczas gdy wykonuje swe czynności (np. sprawdzenie gracza),\nZakazane jest rozpowszechnianie wszelkich informacji (IP,WWW, etc...) o innych serwerach MTA,\nZakazane jest zabijanie osób z administracji podczas interwencji,\nZakazane jest pisanie zdań wielkimi literami, tzw. Caps Lock,\nGracz ma prawo prosić innych o pomoc, nie tylko administrację,\nGracz ma prawo kontaktować się z administracją za pośrednictwem PW w celach pomocniczych,\nGracz ma prawo na składanie skarg na innych graczy/administratorów,\nGracz ma prawo do wypowiadanie się w skargach w których jest oskarżającym/oskarżonym lub wie coś na temat skargi,\nGracz ma prawo do składania podań na wyższą rangę jak dana rekrutacja jest otwarta,\nGracz ma prawo do wypowiadania się w sprawach serwerowych,\nGracz ma prawo pisać propozycje dot. serwera lub nawet udostępnić kod własnego skryptu,\nGracz ma prawo pisać odwołanie od kary (wyjątkiem są kary za skargi lub PERMy),\nGracz musi zgłaszać wszelkie odkryte błędy w grze na forum, w temacie opisać ogólnie, a na PW do administratora Pietr szczegółowo,\nGracz musi zgłosić każdy odkryty błąd/bug do 24H od jego odkrycia,\nSkargi za bany/kicki/muty są automatycznie odrzucane, do tego służy odpowiednia apelacja\n\nReszta regulaminu na forum www.DayZ-POLSKA.tk"
--Чат:\n-Запрещена нецензурная речь,ругательства и оскорбления игроков,в том числе завуалированная\n-Запрещено писать Caps Lock'ом в чат,флудить,просить у Администрации вещи\n-Запрещено разжигать меж политические споры в глобальном, локальном и радио чатах\nпреимущество над другими игроками (ТП,лут,машины).\n__ \n1.1 Оскорбление Родителей в любой форме - Бан навсегда(с возможностью разбана по заявлению\n в соответствующей теме)\n1.2 Использование Caps Lock в грубой форме - мут 2 минуты.\n1.3 Флуд - мут 2 минут.\n1.4 Попрошайничество вещей/телепорта у Администрации - кик с сервера (первые 3 раза,\n в других случаях Администратор в праве выдать бан)\n1.5 Реклама сторонних ресурсов (как открытая так и закрытая реклама) - Бан\n1.6 Использование матерных слов в грубой форме - мут 5 минут\n1.7 Оскорбление Администрации - Бан навсегда (с возможностью разбана)\n1.8 Запрещено обсуждать и поднимать темы о сторонних проектах в глобальном,локальном\n и радио чатах - бан навсегда (с возможностью разбана по заявлению)\n1.9 За разжигание меж политических споров - бан сроком на 30 дней (с возможностью разбана)\n\nБазы:\n- Запрещено хранить не допустимое значение машин в базе.\n(Допустимое кол-во авто зависит от уровня вашей базы, подробнее:\n http://vk.com/topic-54952524_32607620)\n- Запрещено хранить на базе авто без запчастей\n- Запрещается проникать на базы с использованием стороннего софта,\n либо с использованием багов.\n - Если вы проникли на базу в открытые ворота, и вас заперли, вы должны срочно сообщить\nоб этом Администрации и вас вытащат. Если вы воспользуетесь ситуацией в своих целях\n  и выйдите из игры на той или иной базе, ваш аккаунт будет заблокирован.\n__\n2.1 Не допустимое кол-во машин - изъятие всех машин с вашей базы.\n (Администрация взорвет все машины, либо в рандомном порядке, вывезет авто до лимита)\n 2.2 За проникновение на базу с использованием различного рода ПО, либо тех или иных багов\n  - бан навсегда.\n2.3 Выход из игры находясь на чужой базе - бан аккаунта сроком на 10 дней\n\nЧиты,баги:\n- Запрещено использовать читерские программы, хаки, дающие необоснованное преимущество.\n- Запрещено использование любых неисправностей, неполадок, ошибок мода (багов).\n__ \n3.1 За использование читов - бан навсегда ( по IP)\n 3.2 За использование багов - бан навсегда (с возможностью разбана по заявлению)\n\nИгровой процесс:\n- Запрещено убивать игроков на спавне\n- Запрещено использование каких либо программ в бою, которые дают вам преймущество.\n- Установка клан-тега без согласия главы клана\n\n__4.1 SpawnKill (Убийство на спавне) - бан сроком на 1 день\n4.2 Использование программ в бою - бан навсегда (с возможностью разбана по заявлению)\n4.3 Установка клан-тега без согласия главы клана - бан на 1 день\n\nАдминистрация может заблокировать игрока по своему усмотрению, если считает,\n  что он в грубой форме нарушает правила, просьба обратить на это особое внимание!\n-Нарушения правил - БАН (время определяет администратор/модератор)\n\n- НЕЗНАНИЕ ПРАВИЛ НЕ ОСВОБОЖДАЕТ ОТ ОТВЕТСТВЕННОСТИ !!!\n

--Двойной клик в луте: забрать предмет в инвентарь.\nПо всем вопросам аренды баз обращайтесь сюда: vk.com/mta_union\nВы застряли? Чтобы вернутся на спавн используйте: /unbug\nНаша группа ВК: vk.com/mta_union\nДвойной клик в рюкзаке: использовать/установить/взять предмет.\nЧтобы изменить частоту на GPS достаточно ввести: /setgps [частота от 0-9999]\nЧтобы изменить частоту на Рации достаточно ввести: /setradio [частота от 0-9999]\nЧтобы отключить рацию достаточно задать ей частоту 0\nЧтобы отключить GPS достаточно задать ему частоту 0\nЕсли вы устали и не нашли палатки, используйте болеутоляющие\nОружие которая в руках не занимает слотов в рюкзаке\nВыключайте двигатели когда выходишь из машины\nКомпас - B\nЧтобы одеть меньший рюкзак нужно выложить лишний лут\nЧтобы надеть другую розрузку нужно выложить лишний лут\nФонарик - Z\nГлобальный ЧАТ - M\nСистема крепления к машинам - X\nОткрытие дверей в машинах - H

local sw,sh = guiGetScreenSize()
addEventHandler("onClientResourceStart", resourceRoot,
    function()
        helpRenderTarget = dxCreateRenderTarget( 525, 1000, true )
		rulesRenderTarget = dxCreateRenderTarget( 525, 1000, true )
		paperRenderTarget = dxCreateRenderTarget( 525, 1000, true )
    end
)


local yoff = 0

showCursor ( true )


function mouseWheelHelpWindow (up_down)
	local x,y = guiGetPosition (testoLab,false)
    if up_down == 1 then
		if prevY < 0 then
			local newPrevY = prevY+yOffCoeff
			local tempVal = math.abs(prevY)-math.abs(newPrevY)
			yoff = (yoff-yOffCoeffLabel)
			prevY = newPrevY
			prevLabelYPos = newPrevY
			guiSetPosition ( testoLab, sw-302,  sh/2-70-prevY, false )
		end
	else
		if prevY > -yMaxOff then
			local newPrevY = prevY-yOffCoeff
			if newPrevY > 0 then newPrevY = -1 end
			local tempVal = math.abs(prevY)-math.abs(newPrevY)
			yoff = (yoff+yOffCoeffLabel)
			prevY = newPrevY
			prevLabelYPos = newPrevY
			guiSetPosition ( testoLab, sw-302,  sh/2-70-prevY, false )
		end
	end
	--checkRulesSuccesRead()
end

function helpLabMove (x,y)
	if clicked then
		local newPrevY = prevY+prevYPos-y
		local tempVal = math.abs(prevY)-math.abs(newPrevY)
		if ( ( tempVal > 0 and prevY <= 0 ) or ( tempVal < 0 and prevY > -yMaxOff ) ) and tempVal ~= 0 and prevY+newPrevY < 0 then
			--if tempVal > 0 then 
				yoff = (yoff-testOff*tempVal)
			-- else
				-- yoff = (yoff+testOff)
			-- end
			prevY=newPrevY
			guiSetPosition ( testoLab, sw-302,  sh/2-70-prevY, false )
			prevYPos = y
		end
		checkRulesSuccesRead()
	end
end

function checkRulesSuccesRead ()
	if -prevY >= yMaxOff-10 and rulesWindowShowing then
		rulesRead = true 
	end
end

function checkOnButton ()
	if scrollLabelSelected then
		local screenx, screeny, worldx, worldy, worldz = getCursorPosition()
		prevYPos = screeny*screenHeight
		clicked = true
	end
end

function testoLabClick (but, state, x, y)
	clicked = false
end

function buttonLabelEntered ( )
	if getElementData ( source, 'scrollLabel' )then
		scrollLabelSelected = true
	end
end

function buttonLabelLeaved ( )
	if getElementData ( source, 'scrollLabel' ) then
		scrollLabelSelected = false
	end
end

function showHelpWindow ()
	if not helpWindowShowing then
		helpWindowShowing = true
		textInfoHeight = 450
		yOffCoeff = 2900/textInfoHeight
		yOffCoeffLabel = textInfoHeight/29
		testOff = textInfoHeight/145
		yMaxOff = 240
		prevY = 0
		yoff = 0
		prevLabelYPos = 0
		prevYPos = sh/2-65
		heightLabel = 240
		textScrollLabel = guiCreateLabel ( screenWidth/5+650, screenHeight/12+100, 525, 790, '', false )
		testoLab = guiCreateLabel (sw-302,  sh/2-70, 40, 34, '', false )
		setElementData ( testoLab, 'scrollLabel', true )
		bindKey ( 'mouse1', 'down', checkOnButton )
		bindKey ( 'mouse1', 'up', testoLabClick )
		addEventHandler ( "onClientMouseMove", testoLab, helpLabMove, false )
		addEventHandler( "onClientMouseEnter", testoLab, buttonLabelEntered, false )
		addEventHandler( "onClientMouseLeave", testoLab, buttonLabelLeaved, false )
		addEventHandler("onClientRender", getRootElement(), renderHelpWindow)

		addEventHandler( "onClientMouseWheel", root, mouseWheelHelpWindow )
	end
end

function unShowHelpWindow ()
	if helpWindowShowing then
		if isElement ( testoLab ) then destroyElement ( testoLab ) end
		if isElement ( textScrollLabel ) then destroyElement ( textScrollLabel ) end
		unbindKey ( 'mouse1', 'down', checkOnButton )
		unbindKey ( 'mouse1', 'up', testoLabClick )
		removeEventHandler("onClientRender", getRootElement(), renderHelpWindow)
		removeEventHandler("onClientMouseWheel", getRootElement(), mouseWheelHelpWindow)
		helpWindowShowing = false
		clicked = false
	end
end

local fanbox = dxCreateFont( "fanbox.ttf", 28 ) 

function renderHelpWindow()
    if helpRenderTarget then
        dxSetRenderTarget( helpRenderTarget )            
        dxDrawText ( textHelp, 10, 0, 525, 790, tocolor ( 0, 0, 0 ),1,fanbox, "left", "top", false, true )
        dxSetRenderTarget()   
        dxDrawImage( sw-300,  sh/2-75,  34, 290, "roller_back.png",0,0,0,tocolor (255,255,255) )
		dxDrawImage( sw-302,  sh/2-70-prevY,  40, 32, "roller.png",0,0,0,tocolor (255,255,255) )
        dxDrawImageSection ( screenWidth/5+650, screenHeight/12+100,  525, 790, 0, yoff, 525, 790, helpRenderTarget )
    end
end



function renderRulesWindow()
    if rulesRenderTarget then
        dxSetRenderTarget( rulesRenderTarget )            
        dxDrawText ( textRules, 10, 0, 525, 790, tocolor ( 0, 0, 0 ), 1,fanbox, "left", "top", false, true )
        dxSetRenderTarget()   
        dxDrawImage( sw-300,  sh/2-75,  34, 290, "roller_back.png",0,0,0,tocolor (255,255,255) )
		dxDrawImage( sw-302,  sh/2-70-prevY,  40, 32, "roller.png",0,0,0,tocolor (255,255,255) )
        dxDrawImageSection ( screenWidth/5+650, screenHeight/12+100,  525, 790, 0, yoff, 525, 790, rulesRenderTarget )
    end
end

function showRulesWindow ()
	if not rulesWindowShowing then
		rulesWindowShowing = true
		textInfoHeight = 450
		yOffCoeff = 3400/textInfoHeight
		yOffCoeffLabel = textInfoHeight/29
		testOff = textInfoHeight/145
		yMaxOff = 240
		prevY = 0
		yoff = 0
		prevLabelYPos = 0
		prevYPos = sh/2-65
		textScrollLabel = guiCreateLabel ( sw-735,  sh/2-65, 525, 790, '', false )
		testoLab = guiCreateLabel (sw-302,  sh/2-70, 40, 34, '', false )
		setElementData ( testoLab, 'scrollLabel', true )
		bindKey ( 'mouse1', 'down', checkOnButton )
		bindKey ( 'mouse1', 'up', testoLabClick )
		addEventHandler ( "onClientMouseMove", testoLab, rulesLabMove, false )
		addEventHandler( "onClientMouseEnter", testoLab, buttonLabelEntered, false )
		addEventHandler( "onClientMouseLeave", testoLab, buttonLabelLeaved, false )
		addEventHandler( "onClientRender", getRootElement(), renderRulesWindow)

		addEventHandler( "onClientMouseWheel", root, mouseWheelRulesWindow )
	end
end

function unShowRulesWindow ()
	if rulesWindowShowing then
		if isElement ( testoLab ) then destroyElement ( testoLab ) end
		if isElement ( textScrollLabel ) then destroyElement ( textScrollLabel ) end
		unbindKey ( 'mouse1', 'down', checkOnButton )
		unbindKey ( 'mouse1', 'up', testoLabClick )
		removeEventHandler("onClientRender", getRootElement(), renderRulesWindow)
		removeEventHandler("onClientMouseWheel", getRootElement(), mouseWheelRulesWindow)	
		rulesWindowShowing = false
		clicked = false
	end
end

function mouseWheelRulesWindow( up_down )
	local x,y = guiGetPosition (testoLab,false)
	outputChatBox ( prevY)
    if up_down == 1 then
		if prevY < 0 then
			local newPrevY = prevY+yOffCoeff
			local tempVal = math.abs(prevY)-math.abs(newPrevY)
			yoff = (yoff-yOffCoeffLabel)
			prevY = newPrevY
			prevLabelYPos = newPrevY
			--yoff = -newPrevY
			guiSetPosition ( testoLab, sw-302,  sh/2-70-prevY, false )
		end
	else
		if prevY > -yMaxOff then
			local newPrevY = prevY-yOffCoeff
			if newPrevY > 0 then newPrevY = -1 end
			local tempVal = math.abs(prevY)-math.abs(newPrevY)
			yoff = (yoff+yOffCoeffLabel)
			prevY = newPrevY
			prevLabelYPos = newPrevY
			guiSetPosition ( testoLab, sw-302,  sh/2-70-prevY, false )
		end
	end
	checkRulesSuccesRead()
end
	
function rulesLabMove (x,y)
	if clicked then
		local newPrevY = prevY+prevYPos-y
		local tempVal = math.abs(prevY)-math.abs(newPrevY)
		if ( ( tempVal > 0 and prevY <= 0 ) or ( tempVal < 0 and prevY > -yMaxOff ) ) and tempVal ~= 0 and prevY+newPrevY < 0 then
			--if tempVal > 0 then 
				yoff = (yoff-testOff*tempVal)
			-- else
				-- yoff = (yoff+testOff)
			-- end
			prevY=newPrevY
			guiSetPosition ( testoLab, sw-302,  sh/2-70-prevY, false )
			prevYPos = y
		end
		checkRulesSuccesRead()
	end
end

function handleRestore( didClearRenderTargets )
    if didClearRenderTargets then
        -- Do any work here to restore render target contents as required
    end
end
addEventHandler("onClientRestore",root,handleRestore)
